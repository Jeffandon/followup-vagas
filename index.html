<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Follow Up de Vagas</title>
  <style>
    *{margin:0;padding:0;box-sizing:border-box}
    body{font-family:system-ui,-apple-system,sans-serif;background:#f8f9fa;min-height:100vh}
    .header{background:#fff;border-bottom:1px solid #e5e7eb;padding:0 24px;display:flex;justify-content:space-between;align-items:center}
    .nav{display:flex}
    .nav-btn{padding:16px 24px;font-size:15px;font-weight:500;background:transparent;border:none;border-bottom:2px solid transparent;cursor:pointer;color:#6b7280}
    .nav-btn.active{color:#2563eb;border-bottom-color:#2563eb}
    .header-actions{display:flex;gap:8px;padding:10px 0}
    .main{padding:16px;max-width:100%}
    .grid-5{display:grid;grid-template-columns:repeat(5,1fr);gap:12px;margin-bottom:16px}
    .kpi{border-radius:8px;padding:16px;border:1px solid #e5e7eb}
    .kpi-label{font-size:13px;color:#6b7280;margin-bottom:4px}
    .kpi-value{font-size:32px;font-weight:700}
    .kpi-sub{font-size:12px;color:#9ca3af;margin-top:2px}
    .card{background:#fff;border-radius:8px;border:1px solid #e5e7eb;padding:16px;margin-bottom:16px}
    .card-title{font-weight:600;font-size:15px;color:#374151;margin-bottom:12px}
    .etapas-row{display:flex;gap:3px}
    .etapa-card{flex:1;text-align:center;padding:6px 2px;background:#f9fafb;border-radius:4px;border:1px solid #e5e7eb}
    .etapa-name{font-size:9px;color:#6b7280;margin-bottom:2px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
    .etapa-qty{font-size:14px;font-weight:700;color:#111827}
    .etapa-ef{font-size:11px;font-weight:600;border-radius:2px;padding:1px 3px}
    .section-title{font-weight:700;font-size:16px;color:#111827;margin-bottom:12px}
    table{width:100%;border-collapse:collapse;font-size:12px}
    th{padding:8px 4px;text-align:left;font-weight:600;color:#6b7280;border-bottom:2px solid #e5e7eb;white-space:nowrap}
    th.center{text-align:center}
    th.sortable{cursor:pointer}
    th.sortable:hover{color:#2563eb}
    td{padding:10px 4px;border-bottom:1px solid #f3f4f6}
    td.center{text-align:center}
    tr:nth-child(even){background:#f9fafb}
    .badge{padding:3px 8px;border-radius:4px;font-weight:700;font-size:11px}
    .badge-pill{border-radius:20px;padding:3px 12px;font-weight:500}
    .blue-bg{background:#eff6ff}.purple-bg{background:#faf5ff}.green-bg{background:#f0fdf4}.red-bg{background:#fef2f2}.yellow-bg{background:#fefce8}
    .blue{color:#2563eb}.purple{color:#9333ea}.green{color:#16a34a}.red{color:#dc2626}.yellow{color:#ca8a04}
    .page-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:16px}
    .page-title{font-size:20px;font-weight:700}
    .btn-group{display:flex;gap:6px}
    .btn{padding:8px 16px;font-size:13px;font-weight:500;border-radius:5px;border:none;cursor:pointer}
    .btn-primary{background:#2563eb;color:#fff}
    .btn-outline{background:#fff;color:#374151;border:1px solid #d1d5db}
    .btn-success{background:#16a34a;color:#fff}
    .btn-warning{background:#f59e0b;color:#fff}
    .btn-danger{background:#dc2626;color:#fff}
    .btn-sm{padding:5px 10px;font-size:12px;border-radius:4px;min-width:65px;text-align:center}
    .filters{display:grid;grid-template-columns:1fr 170px 170px 170px;gap:12px;align-items:center}
    input,select{width:100%;padding:8px 12px;font-size:13px;border:1px solid #d1d5db;border-radius:5px;outline:none}
    .actions{display:flex;justify-content:flex-end;gap:5px;min-width:270px}
    .modal-overlay{position:fixed;inset:0;background:rgba(0,0,0,.5);display:flex;align-items:center;justify-content:center;z-index:50}
    .modal{background:#fff;border-radius:8px;padding:24px;width:100%;max-width:500px;margin:16px;max-height:90vh;overflow-y:auto}
    .modal-title{font-size:18px;font-weight:700;margin-bottom:20px}
    .form-group{margin-bottom:16px}
    .form-group label{display:block;font-size:13px;font-weight:500;color:#374151;margin-bottom:6px}
    .hidden{display:none}
    .text-gray{color:#6b7280}
    .font-bold{font-weight:700}
    .mb-8{margin-bottom:8px}
    .etapa-col{width:26px;text-align:center;font-size:11px;padding:8px 2px!important}
    .ef-section{margin-bottom:16px;padding-bottom:12px;border-bottom:1px solid #e5e7eb}
    .ef-section:last-child{border-bottom:none;margin-bottom:0;padding-bottom:0}
    .ef-title{font-weight:700;font-size:14px;color:#2563eb;margin-bottom:10px}
    .funcoes-grid{display:grid;grid-template-columns:repeat(2,1fr);gap:16px}
    .funcao-card{background:#fff;border:2px solid #e2e8f0;border-radius:10px;overflow:hidden;box-shadow:0 2px 4px rgba(0,0,0,0.05)}
    .funcao-header{background:linear-gradient(135deg,#1e40af,#3b82f6);color:#fff;padding:12px 16px;font-weight:700;font-size:14px;text-align:center}
    .funcao-body-grid{display:grid;grid-template-columns:1fr 1fr;gap:0}
    .uf-col{padding:12px;border-right:1px solid #e2e8f0}
    .uf-col:last-child{border-right:none}
    .uf-header-box{padding:10px;border-radius:8px;margin-bottom:10px;text-align:center}
    .uf-header-box.uf-ba{background:#fef3c7;border:1px solid #fcd34d}
    .uf-header-box.uf-rn{background:#dbeafe;border:1px solid #93c5fd}
    .uf-nome{font-weight:700;font-size:14px;color:#1e293b}
    .uf-total-num{font-size:20px;font-weight:700;color:#1e40af;margin-top:2px}
    .uf-total-num span{font-size:12px;font-weight:400;color:#64748b}
    .etapas-lista{display:flex;flex-direction:column;gap:5px;margin-bottom:10px}
    .etapa-item{display:flex;align-items:center;gap:8px;padding:5px 8px;background:#f8fafc;border-radius:6px;border:1px solid #e2e8f0;transition:all 0.2s;cursor:pointer}
    .etapa-item:hover{background:#e0e7ff;border-color:#818cf8;transform:scale(1.02)}
    .etapa-item-qty{background:#3b82f6;color:#fff;font-weight:700;font-size:13px;min-width:26px;height:26px;border-radius:50%;display:flex;align-items:center;justify-content:center}
    .etapa-item-name{font-size:12px;color:#334155;font-weight:500;flex:1}
    .etapa-aprovado{background:#f0fdf4;border-color:#86efac}
    .etapa-aprovado .etapa-item-qty{background:#16a34a}
    .etapa-aprovado .etapa-item-name{color:#16a34a;font-weight:600}
    .uf-resumo-box{display:flex;justify-content:space-around;padding:10px;background:#f1f5f9;border-radius:8px;margin-top:auto}
    .resumo-processo,.resumo-aprovado{text-align:center}
    .resumo-num{display:block;font-weight:700;font-size:20px}
    .resumo-label{font-size:11px;color:#64748b}
    .resumo-processo .resumo-num{color:#f59e0b}
    .resumo-aprovado .resumo-num{color:#16a34a}
  </style>
</head>
<body>
  <header class="header">
    <nav class="nav">
      <button class="nav-btn active" id="nav-dashboard" onclick="showTab('dashboard')">Dashboard</button>
      <button class="nav-btn" id="nav-vagas" onclick="showTab('vagas')">Vagas</button>
      <button class="nav-btn" id="nav-candidatos" onclick="showTab('candidatos')">Candidatos</button>
    </nav>
    <div class="header-actions">
      <button class="btn btn-success btn-sm" onclick="exportarDados()">üì• Exportar</button>
      <button class="btn btn-warning btn-sm" onclick="abrirImportar()">üì§ Importar</button>
    </div>
  </header>
  <main class="main">
    <div id="dashboard"></div>
    <div id="vagas" class="hidden"></div>
    <div id="candidatos" class="hidden"></div>
  </main>
  <div id="modal" class="modal-overlay hidden"><div class="modal"><h2 class="modal-title" id="modal-title"></h2><div id="modal-content"></div></div></div>

  <script>
    // DADOS DO USU√ÅRIO (exportados em 2026-01-28)
    const DADOS_INICIAIS = {
      vagas: [{"id": 1, "title": "Ajudante De Motorista", "state": "BA", "quantity": 32}, {"id": 2, "title": "Motorista Carreteiro", "state": "BA", "quantity": 29}, {"id": 3, "title": "Motorista Truck", "state": "BA", "quantity": 7}, {"id": 4, "title": "Tecnico Em Seguranca Do Trabalho", "state": "BA", "quantity": 5}, {"id": 5, "title": "Ajudante De Motorista", "state": "RN", "quantity": 28}, {"id": 6, "title": "Motorista Carreteiro", "state": "RN", "quantity": 22}, {"id": 7, "title": "Motorista Truck", "state": "RN", "quantity": 6}, {"id": 8, "title": "Tecnico Em Seguranca Do Trabalho", "state": "RN", "quantity": 5}],
      candidatos: [{"id": 1, "name": "Naylanda Rosario Silva De Melo", "positionId": 4, "currentStage": 13, "status": "in_process"}, {"id": 2, "name": "Luan Henrique Alaman De Souza", "positionId": 4, "currentStage": 12, "status": "in_process"}, {"id": 5, "name": "Valter Cassio De Oliveira Santos", "positionId": 2, "currentStage": 3, "status": "in_process"}, {"id": 9, "name": "Frankney Araujo Almeida", "positionId": 2, "currentStage": 8, "status": "in_process"}, {"id": 11, "name": "Cristovaldo Da Silva Oliveira", "positionId": 2, "currentStage": 4, "status": "in_process"}, {"id": 13, "name": "Jailson De Jesus De Brito", "positionId": 2, "currentStage": 7, "status": "in_process"}, {"id": 14, "name": "Danilo Santos Ferreira", "positionId": 1, "currentStage": 7, "status": "in_process"}, {"id": 15, "name": "Roque Bispo Serafim", "positionId": 1, "currentStage": 9, "status": "in_process"}, {"id": 16, "name": "Uilson Nascimento Dos Santos", "positionId": 1, "currentStage": 6, "status": "in_process"}, {"id": 17, "name": "Luciano Dos Santos", "positionId": 1, "currentStage": 9, "status": "in_process"}, {"id": 18, "name": "Nilton Cerqueira Moreira", "positionId": 1, "currentStage": 8, "status": "in_process"}, {"id": 19, "name": "Pedro Paulo Araujo Ribeiro", "positionId": 1, "currentStage": 7, "status": "in_process"}, {"id": 20, "name": "Mauricio Concei√ß√£o Da Cruz", "positionId": 1, "currentStage": 9, "status": "in_process"}, {"id": 21, "name": "Augusto Gomes Dos Santos", "positionId": 2, "currentStage": 7, "status": "in_process"}, {"id": 22, "name": "Alcimar Dos Santos Ferreira", "positionId": 2, "currentStage": 7, "status": "in_process"}, {"id": 23, "name": "Jos√© Ronaldo Reis Pereira", "positionId": 2, "currentStage": 7, "status": "in_process"}, {"id": 24, "name": "Alex Santana De Oliveira", "positionId": 3, "currentStage": 7, "status": "in_process"}, {"id": 25, "name": "Antonio Jorge Dos Santos Coutinho", "positionId": 2, "currentStage": 14, "status": "approved"}, {"id": 26, "name": "Deumar Gomes Do Lago", "positionId": 1, "currentStage": 14, "status": "approved"}, {"id": 27, "name": "Lindete Souza De Jesus", "positionId": 4, "currentStage": 13, "status": "in_process"}, {"id": 28, "name": "Jamille De Jesus Pinto", "positionId": 4, "currentStage": 13, "status": "in_process"}, {"id": 29, "name": "Romualdo Souza Cristo", "positionId": 3, "currentStage": 14, "status": "approved"}, {"id": 30, "name": "Lucas De Almeida Silva", "positionId": 3, "currentStage": 14, "status": "approved"}, {"id": 31, "name": "Djalma Dos Santos", "positionId": 3, "currentStage": 14, "status": "approved"}, {"id": 32, "name": "Manoel De Jesus Nunes Junior", "positionId": 2, "currentStage": 14, "status": "approved"}, {"id": 33, "name": "Thiago Marinho Dos Santos", "positionId": 2, "currentStage": 14, "status": "approved"}, {"id": 34, "name": "Sergio Araujo Dos Santos", "positionId": 2, "currentStage": 14, "status": "approved"}, {"id": 35, "name": "Rodrigo Barreto Da Silva", "positionId": 2, "currentStage": 14, "status": "approved"}, {"id": 36, "name": "Renan Lima Dos Santos", "positionId": 2, "currentStage": 14, "status": "approved"}, {"id": 37, "name": "Melquisedeque Araujo Do Lago", "positionId": 2, "currentStage": 14, "status": "approved"}, {"id": 38, "name": "Marcos Silva Matos", "positionId": 2, "currentStage": 13, "status": "in_process"}, {"id": 39, "name": "Marcos De Santana Barroso", "positionId": 2, "currentStage": 14, "status": "approved"}, {"id": 40, "name": "Lucas Fontes Dos Santos", "positionId": 2, "currentStage": 13, "status": "in_process"}, {"id": 41, "name": "Josevaldo Santos De Jesus", "positionId": 2, "currentStage": 14, "status": "approved"}, {"id": 42, "name": "Ademir Ferreira Reis", "positionId": 1, "currentStage": 14, "status": "approved"}, {"id": 43, "name": "Joao Alex Washington Silva Bonfim", "positionId": 2, "currentStage": 14, "status": "approved"}, {"id": 44, "name": "Jailson Reis Santos", "positionId": 2, "currentStage": 14, "status": "approved"}, {"id": 45, "name": "Gilson De Jesus Fernandes", "positionId": 2, "currentStage": 14, "status": "approved"}, {"id": 46, "name": "Alex Rodrigues Soares Lopes", "positionId": 2, "currentStage": 14, "status": "approved"}, {"id": 47, "name": "Edvaldo Gomes Dos Santos", "positionId": 2, "currentStage": 14, "status": "approved"}, {"id": 48, "name": "Edicarlos Ferreira Chagas", "positionId": 2, "currentStage": 14, "status": "approved"}, {"id": 49, "name": "Claudio William Da Silva Natali", "positionId": 2, "currentStage": 14, "status": "approved"}, {"id": 50, "name": "Cesar Ferreira Cerqueira", "positionId": 2, "currentStage": 14, "status": "approved"}, {"id": 51, "name": "Rafael Da Silva Reis", "positionId": 4, "currentStage": 13, "status": "in_process"}, {"id": 52, "name": "Gilmario De Lima Vasconcellos", "positionId": 2, "currentStage": 14, "status": "approved"}, {"id": 53, "name": "Erivaldo Da Hora Ferreira", "positionId": 2, "currentStage": 13, "status": "in_process"}, {"id": 54, "name": "Paulo Ricardo Machado De Morais", "positionId": 1, "currentStage": 14, "status": "approved"}, {"id": 55, "name": "Leandro Do Carmo Santos", "positionId": 1, "currentStage": 14, "status": "approved"}, {"id": 56, "name": "Erasmo Jorge Santana Da Silva", "positionId": 1, "currentStage": 14, "status": "approved"}, {"id": 57, "name": "Anderson Lima Anunciacao", "positionId": 1, "currentStage": 14, "status": "approved"}, {"id": 58, "name": "Weverton Santana Oliveira", "positionId": 1, "currentStage": 14, "status": "approved"}, {"id": 59, "name": "Uellington Santana De Jesus", "positionId": 1, "currentStage": 14, "status": "approved"}, {"id": 60, "name": "Tiago Dos Santos", "positionId": 1, "currentStage": 14, "status": "approved"}, {"id": 61, "name": "Matheus De Oliveira Santana", "positionId": 1, "currentStage": 14, "status": "approved"}, {"id": 62, "name": "Joaquim Henrique Nascimento De Jesus", "positionId": 1, "currentStage": 14, "status": "approved"}, {"id": 63, "name": "Jair De Jesus Dos Santos", "positionId": 1, "currentStage": 14, "status": "approved"}, {"id": 64, "name": "Jailson De Almeida Borges", "positionId": 1, "currentStage": 14, "status": "approved"}, {"id": 65, "name": "Ivenilson Souza De Jesus", "positionId": 1, "currentStage": 14, "status": "approved"}, {"id": 66, "name": "Fabio Brandao Trindade", "positionId": 1, "currentStage": 14, "status": "approved"}, {"id": 67, "name": "Emerson Conceicao Pereira", "positionId": 1, "currentStage": 14, "status": "in_process"}, {"id": 68, "name": "Eduardo Santos Gaspar", "positionId": 1, "currentStage": 14, "status": "approved"}, {"id": 69, "name": "Edmundo Dos Santos Silva", "positionId": 1, "currentStage": 14, "status": "approved"}, {"id": 70, "name": "Edmilson Santos De Santana", "positionId": 1, "currentStage": 14, "status": "approved"}, {"id": 71, "name": "Edmilson Dos Santos Bispo", "positionId": 1, "currentStage": 14, "status": "approved"}, {"id": 72, "name": "Anderson Santos De Andrade", "positionId": 2, "currentStage": 14, "status": "approved"}, {"id": 73, "name": "Daniel Dos Santos Ferreira", "positionId": 1, "currentStage": 14, "status": "approved"}, {"id": 74, "name": "Carlos Alexandre Santana Santa Rosa", "positionId": 1, "currentStage": 13, "status": "in_process"}, {"id": 75, "name": "Antonio Marcos Alexandre Dos Santos", "positionId": 1, "currentStage": 14, "status": "approved"}, {"id": 76, "name": "Antonio Carlos Rocha Simoes", "positionId": 1, "currentStage": 14, "status": "approved"}, {"id": 77, "name": "Adilson De Jesus Barbosa", "positionId": 1, "currentStage": 14, "status": "approved"}, {"id": 78, "name": "Anderson John Da Silva Lopes", "positionId": 8, "currentStage": 14, "status": "in_process"}, {"id": 79, "name": "Jose Leonardo", "positionId": 5, "currentStage": 14, "status": "in_process"}, {"id": 80, "name": "Carlos Antonio Cavalcante", "positionId": 5, "currentStage": 13, "status": "in_process"}, {"id": 81, "name": "Cleudo Rocha Da Silva", "positionId": 6, "currentStage": 14, "status": "in_process"}, {"id": 82, "name": "Antonio Francikleber Candido Dos Santos", "positionId": 5, "currentStage": 12, "status": "in_process"}, {"id": 83, "name": "Ivanio Cabral", "positionId": 6, "currentStage": 14, "status": "in_process"}, {"id": 84, "name": "Isaac Da Silva Dantas", "positionId": 6, "currentStage": 14, "status": "in_process"}, {"id": 86, "name": "Emanuella Fernandes De Queiroz Souza", "positionId": 8, "currentStage": 13, "status": "in_process"}, {"id": 87, "name": "Francisco Eguinaldo Ventura Da Silva", "positionId": 6, "currentStage": 14, "status": "approved"}, {"id": 88, "name": "Zaira Pereira De Paiva", "positionId": 8, "currentStage": 14, "status": "approved"}, {"id": 89, "name": "Gladyson Tertulino De Moura", "positionId": 8, "currentStage": 14, "status": "approved"}, {"id": 90, "name": "Flavio Filgueira", "positionId": 8, "currentStage": 14, "status": "approved"}, {"id": 91, "name": "Sangil Pereira Da Silva", "positionId": 7, "currentStage": 14, "status": "approved"}, {"id": 92, "name": "Ronaldo Adriano Silva Oliveira", "positionId": 7, "currentStage": 14, "status": "approved"}, {"id": 93, "name": "Kleber Wagner Bezerra De Oliveira", "positionId": 7, "currentStage": 14, "status": "approved"}, {"id": 94, "name": "Jocelino Moura De Souza", "positionId": 7, "currentStage": 14, "status": "approved"}, {"id": 95, "name": "Germario Castro De Medeiros", "positionId": 7, "currentStage": 14, "status": "approved"}, {"id": 96, "name": "Francisco Alcivan Lopes", "positionId": 7, "currentStage": 13, "status": "in_process"}, {"id": 97, "name": "Samuel Nascimento De Melo", "positionId": 6, "currentStage": 14, "status": "approved"}, {"id": 98, "name": "Oseias Alves De Oliveira", "positionId": 6, "currentStage": 14, "status": "approved"}, {"id": 99, "name": "Marcus Vinicius Fernandes Costa", "positionId": 6, "currentStage": 14, "status": "approved"}, {"id": 100, "name": "Josinaldo Dantas De Medeiros", "positionId": 6, "currentStage": 14, "status": "approved"}, {"id": 101, "name": "Joseilson Da Fonseca Filgueira", "positionId": 6, "currentStage": 14, "status": "approved"}, {"id": 102, "name": "Joao Batista Bezerra De Andrade", "positionId": 6, "currentStage": 14, "status": "approved"}, {"id": 103, "name": "Jean Carlos Simao Da Silva", "positionId": 6, "currentStage": 14, "status": "approved"}, {"id": 104, "name": "Gilney Carlos De Medeiros", "positionId": 6, "currentStage": 14, "status": "approved"}, {"id": 105, "name": "Geilson Rodrigues De Meneses", "positionId": 6, "currentStage": 14, "status": "approved"}, {"id": 106, "name": "Francisco Roberto Da Silva", "positionId": 6, "currentStage": 14, "status": "approved"}, {"id": 107, "name": "Carlos Rodrigo Varela", "positionId": 5, "currentStage": 14, "status": "in_process"}, {"id": 108, "name": "Francisco Alex De Paulo Silva", "positionId": 5, "currentStage": 13, "status": "in_process"}, {"id": 109, "name": "Anderson Alves Dos Santos Santos", "positionId": 5, "currentStage": 14, "status": "approved"}, {"id": 110, "name": "Antonio Marcos Dos Santos", "positionId": 5, "currentStage": 14, "status": "approved"}, {"id": 111, "name": "Antonio Radamis De Almeida", "positionId": 5, "currentStage": 14, "status": "approved"}, {"id": 112, "name": "Antonio Ronilson Da Silva Oliveira", "positionId": 5, "currentStage": 14, "status": "approved"}, {"id": 113, "name": "Benedito Gislan Vieira De Lima", "positionId": 5, "currentStage": 14, "status": "approved"}, {"id": 114, "name": "Bruno Martins Da Silva", "positionId": 5, "currentStage": 14, "status": "approved"}, {"id": 115, "name": "Emerson Rodrigo Mendes", "positionId": 5, "currentStage": 14, "status": "approved"}, {"id": 116, "name": "Escolastico Pinheiro De Morais Neto", "positionId": 5, "currentStage": 14, "status": "approved"}, {"id": 117, "name": "Francisco De Assis De Souza", "positionId": 5, "currentStage": 14, "status": "approved"}, {"id": 118, "name": "Gilcimar Luiz Da Silva", "positionId": 5, "currentStage": 14, "status": "approved"}, {"id": 119, "name": "Helio Ruarth Morais Penha", "positionId": 5, "currentStage": 14, "status": "approved"}, {"id": 120, "name": "Jose Hellenilton Gomes De Oliveira", "positionId": 5, "currentStage": 14, "status": "approved"}, {"id": 121, "name": "Jose Vanderli Da Silva", "positionId": 5, "currentStage": 14, "status": "approved"}, {"id": 122, "name": "Lair Nascimento De Paiva Junior", "positionId": 5, "currentStage": 14, "status": "approved"}, {"id": 123, "name": "Leonardo Morais De Freitas", "positionId": 5, "currentStage": 14, "status": "approved"}, {"id": 124, "name": "Marivaldo Ribeiro Silva", "positionId": 5, "currentStage": 14, "status": "approved"}, {"id": 125, "name": "Mosaniel Mateus Faustino Gondim", "positionId": 5, "currentStage": 14, "status": "approved"}, {"id": 126, "name": "Oziel Antonio De Freitas", "positionId": 5, "currentStage": 14, "status": "approved"}, {"id": 127, "name": "Paulo Henrique De Sousa Bandeira", "positionId": 5, "currentStage": 14, "status": "approved"}, {"id": 128, "name": "Reginaldo Filho Verissimo", "positionId": 5, "currentStage": 14, "status": "approved"}, {"id": 129, "name": "Willyan Rodrigues Fernandes", "positionId": 5, "currentStage": 14, "status": "approved"}, {"id": 130, "name": "Alexsandro Alves De Melo Melo", "positionId": 6, "currentStage": 13, "status": "in_process"}, {"id": 131, "name": "Geanatan Araujo Batista De Oliveira", "positionId": 6, "currentStage": 14, "status": "in_process"}, {"id": 132, "name": "Jorge Luiz Freire De Souza", "positionId": 6, "currentStage": 13, "status": "in_process"}, {"id": 133, "name": "Alberto Adelino Dos Santos Santos", "positionId": 6, "currentStage": 14, "status": "approved"}, {"id": 134, "name": "Antonio Clovis Bezerra Bezerra", "positionId": 6, "currentStage": 14, "status": "approved"}, {"id": 135, "name": "Carlos Eduardo De Oliveira Santiago", "positionId": 6, "currentStage": 14, "status": "approved"}, {"id": 136, "name": "Evanildo Ferreira De Almeida", "positionId": 6, "currentStage": 14, "status": "approved"}, {"id": 137, "name": "Flaviano Rouge Varela Mendes", "positionId": 6, "currentStage": 14, "status": "approved"}, {"id": 138, "name": "Francisco De Assis Barros", "positionId": 6, "currentStage": 14, "status": "approved"}, {"id": 139, "name": "Alex Paim Dos Santos", "positionId": 1, "currentStage": 3, "status": "in_process"}, {"id": 140, "name": "Caio Porceno Concei√ß√£o", "positionId": 1, "currentStage": 3, "status": "in_process"}, {"id": 141, "name": "Cleres Santos De Jesus", "positionId": 2, "currentStage": 5, "status": "in_process"}, {"id": 143, "name": "Dhonatas Dos Santos Silva", "positionId": 2, "currentStage": 5, "status": "in_process"}, {"id": 144, "name": "Dicson Allan Santos Da Silva", "positionId": 3, "currentStage": 5, "status": "in_process"}, {"id": 145, "name": "Elivan Santana Oliveira", "positionId": 2, "currentStage": 5, "status": "in_process"}, {"id": 146, "name": "Enivaldo Alves Dos Reis Junior", "positionId": 1, "currentStage": 9, "status": "in_process"}, {"id": 147, "name": "Fabio Dos Santos Coelho", "positionId": 1, "currentStage": 3, "status": "in_process"}, {"id": 148, "name": "Gilvan Carlos Ribeiro Das Virgens", "positionId": 2, "currentStage": 5, "status": "in_process"}, {"id": 149, "name": "Ivson Souza De Jesus", "positionId": 1, "currentStage": 3, "status": "in_process"}, {"id": 150, "name": "Jo√£o Nilton Gusm√£o Bastos", "positionId": 2, "currentStage": 3, "status": "in_process"}, {"id": 151, "name": "Jorge Santos Silva", "positionId": 2, "currentStage": 5, "status": "in_process"}, {"id": 152, "name": "Jose Luiz Souza Lima", "positionId": 2, "currentStage": 5, "status": "in_process"}, {"id": 153, "name": "Jos√© Raimundo Dos Santos Pereira", "positionId": 2, "currentStage": 5, "status": "in_process"}, {"id": 154, "name": "Joseilton Santos De Jesus", "positionId": 3, "currentStage": 5, "status": "in_process"}, {"id": 155, "name": "Lenilton Vasconcelos Dos Santos", "positionId": 1, "currentStage": 3, "status": "in_process"}, {"id": 156, "name": "Luiz Claudio De Jesus Dos Santos", "positionId": 2, "currentStage": 5, "status": "in_process"}, {"id": 157, "name": "Magno Henrique De Jesus Carvalho", "positionId": 1, "currentStage": 3, "status": "in_process"}, {"id": 158, "name": "Marcio Batista De Santana", "positionId": 1, "currentStage": 3, "status": "in_process"}, {"id": 159, "name": "Marcos Leal Dos Santos", "positionId": 3, "currentStage": 5, "status": "in_process"}, {"id": 160, "name": "Osmar Cordeiro Dos Santos", "positionId": 1, "currentStage": 3, "status": "in_process"}, {"id": 161, "name": "Reinaldo De Jesus", "positionId": 1, "currentStage": 3, "status": "in_process"}, {"id": 162, "name": "Robson Nascimento Das Virgens", "positionId": 2, "currentStage": 5, "status": "in_process"}, {"id": 163, "name": "Romario De Jesus Marins", "positionId": 2, "currentStage": 5, "status": "in_process"}, {"id": 164, "name": "Thiago Alves Da Concei√ß√£o", "positionId": 3, "currentStage": 5, "status": "in_process"}, {"id": 165, "name": "Uanderson Ferreira Dos Santos", "positionId": 1, "currentStage": 6, "status": "in_process"}, {"id": 166, "name": "Vanderson Chaves Pereira", "positionId": 2, "currentStage": 5, "status": "in_process"}, {"id": 167, "name": "Vinicius Carvalho Da Silva", "positionId": 1, "currentStage": 3, "status": "in_process"}, {"id": 168, "name": "Andrelino Jos√© Da Silva", "positionId": 5, "currentStage": 12, "status": "in_process"}, {"id": 170, "name": "Vladiano Saraiva De Freitas", "positionId": 6, "currentStage": 2, "status": "in_process"}, {"id": 171, "name": "Izid√≥rio Neto De Oliveira", "positionId": 7, "currentStage": 2, "status": "in_process"}, {"id": 172, "name": "Madson Marinho Morais", "positionId": 5, "currentStage": 1, "status": "in_process"}, {"id": 173, "name": "Jackson de Azevedo", "positionId": 6, "currentStage": 13, "status": "in_process"}],
      nextId: 174
    };

    // Fun√ß√µes de checklist
    function criarChecklist() { return [false,false,false,false,false,false,false,false,false,false,false,false,false,false,false]; }
    function migrarCandidato(c) {
      if (!c.checklist) {
        c.checklist = criarChecklist();
        for (let i = 0; i <= c.currentStage; i++) c.checklist[i] = true;
      }
      return c;
    }
    // Conclu√≠do = Candidato na etapa 15 (Aprovado no Portal)
    function candidatoOk(c) { return c.currentStage === 14; }

    // Carregar dados
    function carregarDados() {
      const saved = localStorage.getItem('followup_dados_v2');
      if (saved) {
        try {
          const dados = JSON.parse(saved);
          dados.candidatos = dados.candidatos.map(migrarCandidato);
          return dados;
        } catch(e) { console.error(e); }
      }
      const dados = JSON.parse(JSON.stringify(DADOS_INICIAIS));
      dados.candidatos = dados.candidatos.map(migrarCandidato);
      return dados;
    }

    function salvarDados() {
      localStorage.setItem('followup_dados_v2', JSON.stringify({ vagas, candidatos, nextId }));
    }

    function exportarDados() {
      const dados = { vagas, candidatos, nextId, exportadoEm: new Date().toISOString() };
      const blob = new Blob([JSON.stringify(dados, null, 2)], { type: 'application/json' });
      const a = document.createElement('a'); a.href = URL.createObjectURL(blob);
      a.download = `followup_dados_${new Date().toISOString().slice(0,10)}.json`; a.click();
      alert('‚úÖ Dados exportados! Guarde este arquivo.');
    }

    function abrirImportar() {
      document.getElementById('modal-title').textContent = 'Importar Dados';
      document.getElementById('modal-content').innerHTML = `
        <div style="background:#fefce8;border:1px solid #fde047;padding:12px;border-radius:6px;margin-bottom:12px;color:#a16207;font-size:13px">‚ö†Ô∏è Isso vai substituir TODOS os dados atuais!</div>
        <div class="form-group"><label>Arquivo JSON:</label><input type="file" id="arquivoImport" accept=".json" style="padding:10px;border:2px dashed #d1d5db;width:100%;border-radius:8px"></div>
        <div class="btn-group"><button class="btn btn-warning" style="flex:1" onclick="importarDados()">Importar</button><button class="btn btn-outline" style="flex:1" onclick="closeModal()">Cancelar</button></div>`;
      document.getElementById('modal').classList.remove('hidden');
      setTimeout(() => {
        document.getElementById('arquivoImport').onchange = function(e) {
          const reader = new FileReader();
          reader.onload = (ev) => { window._importJson = ev.target.result; };
          reader.readAsText(e.target.files[0]);
        };
      }, 100);
    }

    function importarDados() {
      try {
        const dados = JSON.parse(window._importJson);
        vagas = dados.vagas; candidatos = dados.candidatos.map(migrarCandidato);
        nextId = dados.nextId || Math.max(0, ...candidatos.map(c => c.id)) + 1;
        salvarDados(); closeModal(); render();
        alert('‚úÖ Importado! ' + candidatos.length + ' candidatos.');
      } catch(e) { alert('‚ùå Erro: JSON inv√°lido'); }
    }

    let dadosCarregados = carregarDados();
    let vagas = dadosCarregados.vagas;
    let candidatos = dadosCarregados.candidatos;
    let nextId = dadosCarregados.nextId || 174;

    const ETAPAS=['Abertura da Vaga','Capta√ß√£o','Triagem','Checagem Dados','Entrevista RH','Teste Pr√°tico','Proposta Benel','ASO','Docs pasta DP','Enviar para DP','Apto para Integra√ß√£o','Subir Doc. Portal','PT Cliente','Integra√ß√£o Cliente','Aprovado no Portal'];
    const ESTADOS=['BA','RN'];
    let currentTab='dashboard',sortCol='name',sortDir='asc';
    let filterSearch='',filterEtapa='todos',filterEstado='todos',filterFuncao='todos';

    function showTab(t) {
      currentTab=t;
      document.querySelectorAll('.nav-btn').forEach(b=>b.classList.remove('active'));
      document.getElementById('nav-'+t).classList.add('active');
      ['dashboard','vagas','candidatos'].forEach(x=>document.getElementById(x).classList.add('hidden'));
      document.getElementById(t).classList.remove('hidden');
      render();
    }

    function getVagasInfo() { return vagas.map(v=>({...v,totalCandidates:candidatos.filter(c=>c.positionId===v.id).length,candidatesByStage:ETAPAS.map((_,i)=>candidatos.filter(c=>c.positionId===v.id&&c.currentStage===i).length)})); }

    function renderDashboard() {
      const vi=getVagasInfo(), tp=vagas.reduce((s,v)=>s+v.quantity,0), tc=candidatos.length;
      const okTotal = candidatos.filter(candidatoOk).length;
      const pendTotal = tp - okTotal; // Pendentes = Meta - Conclu√≠dos
      const candBA = candidatos.filter(c=>vagas.find(v=>v.id===c.positionId)?.state==='BA');
      const candRN = candidatos.filter(c=>vagas.find(v=>v.id===c.positionId)?.state==='RN');
      const metaBA = vagas.filter(v=>v.state==='BA').reduce((s,v)=>s+v.quantity,0);
      const metaRN = vagas.filter(v=>v.state==='RN').reduce((s,v)=>s+v.quantity,0);
      const okBA = candBA.filter(candidatoOk).length, okRN = candRN.filter(candidatoOk).length;
      const pendBA = metaBA - okBA, pendRN = metaRN - okRN; // Pendentes por estado = Meta estado - Conclu√≠dos estado
      const eg = tp>0 ? Math.round(okTotal/tp*100) : 0;

      const cpe=ETAPAS.map((_,i)=>candidatos.filter(c=>c.currentStage===i).length);
      const epe=ETAPAS.map((_,i)=>tp>0?Math.round(cpe[i]/tp*100):0);
      const efGeral=`<div class="ef-section"><div class="ef-title">üìä Vis√£o Geral</div><div class="etapas-row">${ETAPAS.map((et,i)=>`<div class="etapa-card"><div class="etapa-name">${et}</div><div class="etapa-qty">${cpe[i]||'-'}</div><div class="etapa-ef" style="background:${cpe[i]>0?(epe[i]>=50?'#dcfce7':'#fef9c3'):'transparent'};color:${cpe[i]>0?(epe[i]>=50?'#16a34a':'#ca8a04'):'#9ca3af'}">${epe[i]}%</div></div>`).join('')}</div></div>`;

      const funcoes=[...new Set(vagas.map(v=>v.title))];
      let efCruzada=`<div class="ef-section"><div class="ef-title">üéØ Follow Up por Fun√ß√£o e Unidade</div><div class="funcoes-grid">`;
      funcoes.forEach(func=>{
        const dadosEstados=[];
        ['BA','RN'].forEach(est=>{
          const vaga=vagas.find(v=>v.title===func&&v.state===est);
          if(!vaga)return;
          const cands=candidatos.filter(c=>c.positionId===vaga.id);
          const porEtapa=ETAPAS.map((_,i)=>({idx:i,nome:ETAPAS[i],qty:cands.filter(c=>c.currentStage===i).length}));
          // Ordenar por fase (√≠ndice crescente: 0‚Üí14, de cima para baixo)
          const comCand=porEtapa.filter(e=>e.qty>0).sort((a,b)=>a.idx-b.idx);
          const total=cands.length, ok=cands.filter(candidatoOk).length, pend=total-ok;
          const meta=vaga.quantity;
          dadosEstados.push({est,vaga,comCand,total,ok,pend,meta});
        });
        if(!dadosEstados.length)return;
        const maxH=Math.max(...dadosEstados.map(d=>d.comCand.length));
        efCruzada+=`<div class="funcao-card"><div class="funcao-header">${func}</div><div class="funcao-body-grid">`;
        dadosEstados.forEach(d=>{
          const faltam = d.meta - d.ok;
          efCruzada+=`<div class="uf-col"><div class="uf-header-box uf-${d.est.toLowerCase()}"><div class="uf-nome">${d.est==='BA'?'Bahia':'Rio Grande do Norte'}</div><div class="uf-total-num">${d.total} <span>candidatos</span></div><div style="margin-top:4px;font-size:12px;color:#1e40af;font-weight:600">Meta: ${d.meta}</div><div style="margin-top:4px;font-size:12px;font-weight:700;color:${faltam>0?'#dc2626':'#16a34a'}">${faltam>0?'Faltam p/ Meta: '+faltam:'‚úì Meta atingida!'}</div></div><div class="etapas-lista" style="min-height:${maxH*38}px">`;
          d.comCand.forEach(e=>{
            efCruzada+=`<div class="etapa-item ${e.idx===14?'etapa-aprovado':''}" onclick="mostrarCandidatosEtapa(${d.vaga.id},${e.idx})"><span class="etapa-item-qty">${e.qty}</span><span class="etapa-item-name">${e.nome}</span></div>`;
          });
          efCruzada+=`</div><div class="uf-resumo-box"><div class="resumo-processo"><span class="resumo-num">${d.pend}</span><span class="resumo-label">‚è≥ em processo</span></div><div class="resumo-aprovado"><span class="resumo-num">${d.ok}</span><span class="resumo-label">‚úÖ conclu√≠dos</span></div></div></div>`;
        });
        efCruzada+=`</div></div>`;
      });
      efCruzada+=`</div></div>`;

      document.getElementById('dashboard').innerHTML=`
        <div class="grid-5">
          <div class="kpi blue-bg"><div class="kpi-label">Vagas Planejadas</div><div class="kpi-value blue">${tp}</div><div class="kpi-sub">${vagas.length} tipos de vaga</div></div>
          <div class="kpi purple-bg"><div class="kpi-label">Total Candidatos</div><div class="kpi-value purple">${tc}</div><div class="kpi-sub">BA: ${candBA.length} | RN: ${candRN.length}</div></div>
          <div class="kpi green-bg"><div class="kpi-label">Conclu√≠dos (PT+Integ)</div><div class="kpi-value green">${okTotal}</div><div class="kpi-sub">BA: ${okBA} | RN: ${okRN}</div></div>
          <div class="kpi ${pendTotal>0?'yellow-bg':'green-bg'}"><div class="kpi-label">Faltam p/ Meta</div><div class="kpi-value ${pendTotal>0?'yellow':'green'}">${pendTotal}</div><div class="kpi-sub">BA: ${pendBA} | RN: ${pendRN}</div></div>
          <div class="kpi ${eg>=80?'green-bg':eg>=50?'yellow-bg':'red-bg'}"><div class="kpi-label">Efici√™ncia</div><div class="kpi-value ${eg>=80?'green':eg>=50?'yellow':'red'}">${eg}%</div><div class="kpi-sub">Meta: ${tp}</div></div>
        </div>
        <div class="card"><div class="card-title">Efici√™ncia por Etapa</div>${efGeral}${efCruzada}</div>`;
    }

    function mostrarCandidatosEtapa(positionId, etapaIdx) {
      const vaga=vagas.find(v=>v.id===positionId);
      const cands=candidatos.filter(c=>c.positionId===positionId&&c.currentStage===etapaIdx);
      document.getElementById('modal-title').textContent=ETAPAS[etapaIdx];
      document.getElementById('modal-content').innerHTML=`
        <div style="background:#f1f5f9;padding:12px;border-radius:8px;margin-bottom:16px"><div style="font-size:13px;color:#64748b">Vaga: <strong style="color:#1e40af">${vaga.title}</strong> - ${vaga.state==='BA'?'Bahia':'RN'}</div><div style="font-size:13px;color:#64748b">Total: <strong style="color:#16a34a">${cands.length}</strong></div></div>
        <div style="max-height:350px;overflow-y:auto">${cands.length?`<table style="width:100%;font-size:12px"><thead><tr style="background:#f8fafc"><th style="padding:8px;text-align:left">#</th><th style="padding:8px;text-align:left">Nome</th><th style="padding:8px;text-align:center">Status</th><th style="padding:8px;text-align:center">A√ß√£o</th></tr></thead><tbody>${cands.map((c,i)=>{const ok=candidatoOk(c),m=c.checklist?c.checklist.filter(x=>x).length:0;return`<tr style="${ok?'background:#f0fdf4':''}"><td style="padding:8px">${i+1}</td><td style="padding:8px;font-weight:500">${c.name}</td><td style="padding:8px;text-align:center">${ok?'<span style="background:#dcfce7;color:#16a34a;padding:2px 8px;border-radius:10px;font-size:10px">‚úì OK</span>':`<span style="background:#fef3c7;color:#92400e;padding:2px 8px;border-radius:10px;font-size:10px">${m}/15</span>`}</td><td style="padding:8px;text-align:center"><button class="btn btn-primary btn-sm" onclick="closeModal();setTimeout(()=>openChecklist(${c.id}),100)" style="font-size:11px;padding:4px 8px">Checklist</button></td></tr>`}).join('')}</tbody></table>`:'<p style="text-align:center;color:#64748b;padding:20px">Nenhum candidato</p>'}</div>
        <div class="btn-group" style="margin-top:16px"><button class="btn btn-outline" style="flex:1" onclick="closeModal()">Fechar</button></div>`;
      document.getElementById('modal').classList.remove('hidden');
    }

    function openChecklist(id) {
      const c=candidatos.find(x=>x.id===id);
      const v=vagas.find(x=>x.id===c.positionId);
      if(!c.checklist){c.checklist=criarChecklist();for(let i=0;i<=c.currentStage;i++)c.checklist[i]=true;}
      const ok=candidatoOk(c);
      document.getElementById('modal-title').textContent='Checklist de Etapas';
      document.getElementById('modal-content').innerHTML=`
        <div style="background:#f1f5f9;padding:12px;border-radius:8px;margin-bottom:16px">
          <div style="font-size:14px;font-weight:600;color:#1e293b">${c.name}</div>
          <div style="font-size:12px;color:#64748b">${v?.title||'N/A'} - ${v?.state==='BA'?'Bahia':'RN'}</div>
          <div style="margin-top:8px">${ok?'<span style="background:#dcfce7;color:#16a34a;padding:4px 12px;border-radius:20px;font-size:12px;font-weight:600">‚úÖ CONCLU√çDO</span>':'<span style="background:#fef3c7;color:#92400e;padding:4px 12px;border-radius:20px;font-size:12px;font-weight:600">‚è≥ PENDENTE</span>'}</div>
        </div>
        <div style="max-height:320px;overflow-y:auto">${ETAPAS.map((et,i)=>{const chk=c.checklist[i],obr=i===12||i===13;return`<label style="display:flex;align-items:center;gap:10px;padding:8px 10px;margin-bottom:4px;background:${chk?'#f0fdf4':'#fff'};border:1px solid ${chk?'#86efac':'#e2e8f0'};border-radius:6px;cursor:pointer"><input type="checkbox" ${chk?'checked':''} onchange="toggleEtapa(${id},${i})" style="width:18px;height:18px"><span style="flex:1;font-size:13px;color:${chk?'#16a34a':'#334155'};font-weight:${chk?'600':'400'}">${i+1}. ${et}</span>${obr?'<span style="background:#dbeafe;color:#1d4ed8;padding:2px 6px;border-radius:4px;font-size:9px;font-weight:600">OBRIGAT√ìRIO</span>':''}${chk?'<span style="color:#16a34a">‚úì</span>':''}</label>`}).join('')}</div>
        <div class="btn-group" style="margin-top:16px"><button class="btn btn-success" style="flex:1" onclick="marcarTodas(${id})">‚úì Todas</button><button class="btn btn-outline" style="flex:1" onclick="desmarcarTodas(${id})">‚úó Limpar</button></div>
        <div class="btn-group" style="margin-top:8px"><button class="btn btn-primary" style="flex:1" onclick="closeModal();render()">Fechar</button></div>`;
      document.getElementById('modal').classList.remove('hidden');
    }

    function toggleEtapa(id,idx){const c=candidatos.find(x=>x.id===id);c.checklist[idx]=!c.checklist[idx];let last=-1;for(let i=14;i>=0;i--)if(c.checklist[i]){last=i;break;}c.currentStage=last>=0?last:0;salvarDados();openChecklist(id);}
    function marcarTodas(id){const c=candidatos.find(x=>x.id===id);c.checklist=[true,true,true,true,true,true,true,true,true,true,true,true,true,true,true];c.currentStage=14;salvarDados();openChecklist(id);}
    function desmarcarTodas(id){const c=candidatos.find(x=>x.id===id);c.checklist=criarChecklist();c.currentStage=0;salvarDados();openChecklist(id);}

    function renderVagas(){
      const vi=getVagasInfo();
      document.getElementById('vagas').innerHTML=`<div class="page-header"><h1 class="page-title">Vagas</h1><button class="btn btn-primary" onclick="openModalVaga()">+ Nova Vaga</button></div><div class="card" style="padding:0"><table><thead><tr><th>Vaga</th><th>Estado</th><th class="center">Qtd</th><th class="center">Candidatos</th><th class="center">A√ß√µes</th></tr></thead><tbody>${vi.map(v=>`<tr><td>${v.title}</td><td>${v.state}</td><td class="center"><span class="badge-pill" style="background:#dbeafe;color:#1d4ed8">${v.quantity}</span></td><td class="center"><span class="badge-pill" style="background:#f3e8ff;color:#7c3aed">${v.totalCandidates}</span></td><td class="center"><button class="btn btn-outline btn-sm" onclick="openModalVaga(${v.id})">Editar</button> <button class="btn btn-danger btn-sm" onclick="deleteVaga(${v.id})">Deletar</button></td></tr>`).join('')}</tbody></table></div>`;
    }

    function renderCandidatos(){
      const funcoes=[...new Set(vagas.map(v=>v.title))];
      document.getElementById('candidatos').innerHTML=`<div class="page-header"><h1 class="page-title">Candidatos</h1><div class="btn-group"><button class="btn btn-success" onclick="exportarExcel()">üìä Exportar Excel</button><button class="btn btn-primary" onclick="openModalCandidato()">+ Novo</button></div></div><div class="card"><div class="filters"><input type="text" placeholder="Buscar..." value="${filterSearch}" oninput="filterSearch=this.value;renderTableCand()"><select onchange="filterEtapa=this.value;renderTableCand()"><option value="todos">Todas Etapas</option>${ETAPAS.map((e,i)=>`<option value="${i}" ${filterEtapa==i?'selected':''}>${i+1}. ${e}</option>`).join('')}</select><select onchange="filterEstado=this.value;renderTableCand()"><option value="todos">Todos Estados</option>${ESTADOS.map(e=>`<option value="${e}" ${filterEstado===e?'selected':''}>${e}</option>`).join('')}</select><select onchange="filterFuncao=this.value;renderTableCand()"><option value="todos">Todas Fun√ß√µes</option>${funcoes.map(f=>`<option value="${f}" ${filterFuncao===f?'selected':''}>${f}</option>`).join('')}</select></div></div><div class="card" style="padding:0"><table><thead><tr><th onclick="sortCol='name';sortDir=sortDir==='asc'?'desc':'asc';renderTableCand()" style="cursor:pointer">Nome</th><th>Vaga</th><th>Etapas</th><th class="center" style="width:200px">A√ß√µes</th></tr></thead><tbody id="tbodyCand"></tbody></table></div>`;
      renderTableCand();
    }

    function exportarExcel(){
      // Preparar dados
      let dados = candidatos.map(c => {
        const v = vagas.find(x => x.id === c.positionId);
        return {
          nome: c.name,
          funcao: v?.title || 'N/A',
          etapa: ETAPAS[c.currentStage] || 'N/A',
          estado: v?.state === 'BA' ? 'Bahia' : v?.state === 'RN' ? 'Rio Grande do Norte' : 'N/A',
          status: candidatoOk(c) ? 'Conclu√≠do' : 'Pendente'
        };
      });
      
      // Aplicar filtros atuais
      dados = dados.filter(d => {
        const matchSearch = d.nome.toLowerCase().includes(filterSearch.toLowerCase());
        const matchEstado = filterEstado === 'todos' || (filterEstado === 'BA' && d.estado === 'Bahia') || (filterEstado === 'RN' && d.estado === 'Rio Grande do Norte');
        const matchFuncao = filterFuncao === 'todos' || d.funcao === filterFuncao;
        return matchSearch && matchEstado && matchFuncao;
      });
      
      // Ordenar por nome
      dados.sort((a, b) => a.nome.localeCompare(b.nome));
      
      // Criar CSV (compat√≠vel com Excel)
      const sep = ';'; // Separador que Excel BR reconhece melhor
      let csv = '\uFEFF'; // BOM para UTF-8
      csv += ['Nome', 'Fun√ß√£o/Vaga', 'Etapa Atual', 'Estado', 'Status'].join(sep) + '\n';
      dados.forEach(d => {
        csv += [d.nome, d.funcao, d.etapa, d.estado, d.status].join(sep) + '\n';
      });
      
      // Download
      const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
      const a = document.createElement('a');
      a.href = URL.createObjectURL(blob);
      a.download = `candidatos_${new Date().toISOString().slice(0,10)}.csv`;
      a.click();
      
      alert('‚úÖ Arquivo exportado!\\n\\nDica: Abra no Excel e os dados estar√£o separados em colunas.');
    }

    function renderTableCand(){
      let f=candidatos.filter(c=>{const v=vagas.find(x=>x.id===c.positionId);return c.name.toLowerCase().includes(filterSearch.toLowerCase())&&(filterEtapa==='todos'||c.currentStage===parseInt(filterEtapa))&&(filterEstado==='todos'||(v&&v.state===filterEstado))&&(filterFuncao==='todos'||(v&&v.title===filterFuncao));});
      f.sort((a,b)=>{const va=a.name.toLowerCase(),vb=b.name.toLowerCase();return sortDir==='asc'?(va<vb?-1:1):(va>vb?-1:1);});
      document.getElementById('tbodyCand').innerHTML=f.slice(0,200).map(c=>{const v=vagas.find(x=>x.id===c.positionId),ok=candidatoOk(c),m=c.checklist?c.checklist.filter(x=>x).length:0;return`<tr style="${ok?'background:#f0fdf4':''}"><td>${c.name}${ok?' <span style="background:#dcfce7;color:#16a34a;padding:2px 6px;border-radius:10px;font-size:10px">‚úì</span>':''}</td><td class="text-gray">${v?.title||'-'}</td><td><span class="badge" style="background:#dbeafe;color:#1d4ed8">${c.currentStage+1}. ${ETAPAS[c.currentStage]}</span> <span style="color:#9ca3af;font-size:11px">(${m}/15)</span></td><td><div class="actions"><button class="btn btn-primary btn-sm" onclick="openChecklist(${c.id})">Checklist</button><button class="btn btn-danger btn-sm" onclick="deleteCandidato(${c.id})">Deletar</button></div></td></tr>`}).join('');
    }

    function render(){if(currentTab==='dashboard')renderDashboard();else if(currentTab==='vagas')renderVagas();else renderCandidatos();}
    function closeModal(){document.getElementById('modal').classList.add('hidden');}

    function openModalVaga(id=null){
      const v=id?vagas.find(x=>x.id===id):null;
      document.getElementById('modal-title').textContent=v?'Editar Vaga':'Nova Vaga';
      document.getElementById('modal-content').innerHTML=`<div class="form-group"><label>Nome</label><input type="text" id="vagaTitle" value="${v?.title||''}"></div><div class="form-group"><label>Estado</label><select id="vagaState">${ESTADOS.map(e=>`<option value="${e}" ${v?.state===e?'selected':''}>${e}</option>`).join('')}</select></div><div class="form-group"><label>Quantidade</label><input type="number" id="vagaQty" value="${v?.quantity||1}"></div><div class="btn-group"><button class="btn btn-primary" style="flex:1" onclick="saveVaga(${id})">Salvar</button><button class="btn btn-outline" style="flex:1" onclick="closeModal()">Cancelar</button></div>`;
      document.getElementById('modal').classList.remove('hidden');
    }

    function saveVaga(id){const t=document.getElementById('vagaTitle').value.trim(),s=document.getElementById('vagaState').value,q=parseInt(document.getElementById('vagaQty').value)||1;if(!t){alert('Preencha o nome');return;}if(id){const v=vagas.find(x=>x.id===id);v.title=t;v.state=s;v.quantity=q;}else{vagas.push({id:Math.max(0,...vagas.map(v=>v.id))+1,title:t,state:s,quantity:q});}salvarDados();closeModal();render();}
    function deleteVaga(id){if(confirm('Deletar vaga e candidatos?')){vagas=vagas.filter(v=>v.id!==id);candidatos=candidatos.filter(c=>c.positionId!==id);salvarDados();render();}}

    function openModalCandidato(){
      document.getElementById('modal-title').textContent='Novo Candidato';
      document.getElementById('modal-content').innerHTML=`<div class="form-group"><label>Nome</label><input type="text" id="candName"></div><div class="form-group"><label>Vaga</label><select id="candVaga"><option value="">Selecione</option>${vagas.map(v=>`<option value="${v.id}">${v.title} - ${v.state}</option>`).join('')}</select></div><div class="form-group"><label>Etapa Inicial</label><select id="candEtapa">${ETAPAS.map((e,i)=>`<option value="${i}">${i+1}. ${e}</option>`).join('')}</select></div><div class="btn-group"><button class="btn btn-primary" style="flex:1" onclick="saveCandidato()">Salvar</button><button class="btn btn-outline" style="flex:1" onclick="closeModal()">Cancelar</button></div>`;
      document.getElementById('modal').classList.remove('hidden');
    }

    function saveCandidato(){const n=document.getElementById('candName').value.trim(),p=parseInt(document.getElementById('candVaga').value),e=parseInt(document.getElementById('candEtapa').value)||0;if(!n){alert('Preencha o nome');return;}if(!p){alert('Selecione vaga');return;}const chk=criarChecklist();for(let i=0;i<=e;i++)chk[i]=true;candidatos.push({id:nextId++,name:n,positionId:p,currentStage:e,status:'in_process',checklist:chk});salvarDados();closeModal();render();}
    function deleteCandidato(id){if(confirm('Deletar?')){candidatos=candidatos.filter(c=>c.id!==id);salvarDados();renderTableCand();}}

    document.getElementById('modal').onclick=function(e){if(e.target===this)closeModal();};
    render();
  </script>
</body>
</html>
